<!DOCTYPE html>
<html>
    <head>
        <title>Rich-Gureckis_Generalizability_newtitle</title>
        <script src="jspsych-6.3.1/jspsych.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-survey-multi-select.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-image-button-response.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-preload.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-survey-multi-choice.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-instructions.js"></script>
        <link rel="stylesheet" href="jspsych-6.3.1/css/jspsych.css" type="text/css">
    </head>
    <body></body>
    <script>
    
        var timeline = [];

        var condition_assignment = jsPsych.randomization.sampleWithoutReplacement(['conditionA', 'conditionB', 'conditionC'], 1)[0];

        jsPsych.data.addProperties({
            condition: condition_assignment
        });

        console.log(condition_assignment);

        var images = [
                        'bees-with-color/bees-01-color.svg',
                        'bees-with-color/bees-02-color.svg',
                        'bees-with-color/bees-03-color.svg',
                        'bees-with-color/bees-04-color.svg',
                        'bees-with-color/bees-05-color.svg',
                        'bees-with-color/bees-06-color.svg',
                        'bees-with-color/bees-07-color.svg',
                        'bees-with-color/bees-08-color.svg',
                    ];

        var preload = {
            type: 'preload',
            images: images,
            max_load_time: 30000,
            message: 'Please wait while the experiment loads',
            error_message: 'The experiment failed to load. Please contact the researcher.'
        };

        timeline.push(preload);

        // WELCOME SCREEN
        var welcome_screen = {
            type: 'html-keyboard-response',
            stimulus: 'Welcome!'
        }

        timeline.push(welcome_screen)

        // INSTRUCTIONS
        var instructions = {
          type: 'instructions',
            pages: [
                'Here are some instructions. They tell you what to do!',
                'Oh look, another page of instructions! <br>'+
                'This must be a complicated experiment.',
                'Wow, I hope this is the final page of instructions.'
            ],
            show_clickable_nav: true
        } 
      
        var instructions_quiz_questions = [
            {
              prompt: 'This is the text of the first question.',
              options: ['firstQ_option1_CORRECT', 'firstQ_option2', 'firstQ_option3'],
              required: true,
              correct_response: 'firstQ_option1_CORRECT',
              name: 'Q1'
            },
            {
              prompt: 'This is the text of the second question.',
              options: ['secondQ_option1', 'secondQ_option2_CORRECT', 'secondQ_option3'],
              required: true,
              correct_response: 'secondQ_option2_CORRECT',
              name: 'Q2'
            },
            {
              prompt: 'This is the text of the third question.',
              options: ['thirdQ_option1', 'thirdQ_option2', 'thirdQ_option3_CORRECT'],
              required: true,
              correct_response: 'thirdQ_option3_CORRECT',
              name: 'Q3'
            }
        ]
    
        // ACTUAL TRIAL

        var actual_trial = {
            timeline: [
                {
                    type: 'image-button-response',
                    stimulus: jsPsych.timelineVariable('bee'),
                    choices: ['Harvest', 'Avoid'],
                    prompt: "<p>Harvest or avoid?</p>",
                    margin_horizontal: '16px'
                },
                // {
                //     type: 'html-keyboard-response',
                //     stimulus: '',
                //     choices: jsPsych.NO_KEYS,
                //     trial_duration: 250
                // },
             ],
        
            timeline_variables: [
                { bee: 'bees-with-color/bees-01-color.svg'},
                { bee: 'bees-with-color/bees-02-color.svg'},
                { bee: 'bees-with-color/bees-03-color.svg'},
                { bee: 'bees-with-color/bees-04-color.svg'},
            ],
            randomize_order: true
        }

        var node = {
            timeline: [actual_trial],
            repetitions: 2
        }

        timeline.push(node);

        

        // POST QUESTIONNAIRE
        var scale_1 = ["no","yes"];

        var post_q1 = {
            type: 'survey-text',
            questions: [
                {
                    prompt: 'About what percentage of beehives do you think contained dangerous bees?',
                    name: 'percent-dangerous-bees',
                    placeholder: '(enter a value between 0 and 100)',
                    required: true,
                }
            ],
        };

        var post_q2 = {
            type: 'survey-multi-select',
            questions: [
                {
                    prompt: `<p>Which features do you think were useful for deciding whether a bee variety was friendly or dangerous?</p>`,
                    options: ["Wings", "Antennae", "Stripes", "Legs"], 
                    name: 'feature-perception',
                    required: true,
                },
            ],        
            randomize_question_order: true        
        };

        var post_q3 = {
            type: 'survey-text',
            questions: [
                 {
                    prompt: 'Did you use pen and paper?',
                    name: 'pen-and-paper',
                    placeholder: '(Please be honest.)',
                    required: true,
                }, 
            ], 
        };

        var post_questionnaire = {
            timeline: [post_q1, post_q2, post_q3]
        }

        timeline.push(post_questionnaire);

        var post_instructions_quiz = {
          type: 'survey-multi-choice',
          questions: instructions_quiz_questions,
          on_finish: (data) => {
            var Q1_correct = jsPsych.pluginAPI.compareKeys(data.response.Q1, instructions_quiz_questions[0].correct_response);
            var Q2_correct = jsPsych.pluginAPI.compareKeys(data.response.Q2, instructions_quiz_questions[1].correct_response);
            var Q3_correct = jsPsych.pluginAPI.compareKeys(data.response.Q3, instructions_quiz_questions[2].correct_response);
            data.correct = Q1_correct && Q2_correct && Q3_correct;
          }
        }

        var instructions_quiz_feedback = {
          type: 'html-button-response',
          stimulus: () => {
            all_correct = jsPsych.data.get().last(1).values()[0].correct;
            if(all_correct) {
              return `<p>Congrats, you got everything right</p>`
            } else {
              return `<p>At least one answer was incorrect. Please review instructions before continuing.</p>`
            }
          },
          choices: ['Continue']
        }

        var instruction_repeat = {
          timeline: [
            instructions,
            post_instructions_quiz,
            {
              type: `html-keyboard-response`,
              stimulus: () => {
                all_correct = jsPsych.data.get().last(1).values()[0].correct;
                if(all_correct) {
                  return `<p>Congrats, you got everything right!<br>Press any key to continue to the experiment.</p>`
                }  else {
                  return `<p>At least one answer is incorrect. Your participation is no longer requested in this experiment.</p>`
                }
              }
            }
          ],
          conditional_function: () => {
            all_correct = jsPsych.data.get().last(2).values()[0].correct;
            return !all_correct;
          }
        }

        var instructions_sequence = {
          timeline: [instructions, post_instructions_quiz, instructions_quiz_feedback, instruction_repeat]
        }
        timeline.push(instructions_sequence)
        
      
        jsPsych.init({
            timeline: timeline,
            default_iti: 250, 
            on_finish: function() {
                jsPsych.data.displayData();
            }
        });
        
    </script>
</html>
