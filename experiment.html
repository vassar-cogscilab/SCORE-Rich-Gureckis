<!DOCTYPE html>
<html>
    <head>
        <title>Rich-Gureckis_Generalizability_newtitle</title>
        <script src="jspsych-6.3.1/jspsych.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.3.1/plugins/jspsych-survey-multi-choice.js"></script>
        <link rel="stylesheet" href="jspsych-6.3.1/css/jspsych.css" type="text/css">
    </head>
    <body></body>
    <script>
    
        var timeline = [];

        // WELCOME SCREEN
        var welcome_screen = {
            type: 'html-keyboard-response',
            stimulus: 'Welcome!'
        }

        timeline.push(welcome_screen)

        // INSTRUCTIONS
        var instructions = {
            type: 'html-button-response',
            stimulus: `
                <p> Sample instructions. </p>,
                <p> Amet Lorem ex pariatur nulla magna non amet mollit laboris id commodo laboris irure veniam. </p>
             `,
            choices: ['Continue']
        }

        var instuctions_quiz_questions = [
            {
              prompt: 'This is the text of the first question.',
              options: ['firstQ_option1_CORRECT', 'firstQ_option2', 'firstQ_option3'],
              required: true,
              correct_response: 'firstQ_option1_CORRECT',
              name: 'Q1'
            },
            {
              prompt: 'This is the text of the second question.',
              options: ['secondQ_option1', 'secondQ_option2_CORRECT', 'secondQ_option3'],
              required: true,
              correct_response: 'secondQ_option2_CORRECT',
              name: 'Q2'
            },
            {
              prompt: 'This is the text of the third question.',
              options: ['thirdQ_option1', 'thirdQ_option2', 'thirdQ_option3_CORRECT'],
              required: true,
              correct_response: 'thirdQ_option3_CORRECT',
              name: 'Q3'
            }
        ]

        var post_instructions_quiz = {
          type: 'survey-multi-choice',
          questions: instuctions_quiz_questions,
          on_finish: (data) => {
            var Q1_correct = jsPsych.pluginAPI.compareKeys(data.response.Q1, instuctions_quiz_questions[0].correct_response);
            var Q2_correct = jsPsych.pluginAPI.compareKeys(data.response.Q2, instuctions_quiz_questions[1].correct_response);
            var Q3_correct = jsPsych.pluginAPI.compareKeys(data.response.Q3, instuctions_quiz_questions[2].correct_response);
            data.correct = Q1_correct && Q2_correct && Q3_correct;
          }
        }

        var instuctions_quiz_feedback = {
          type: 'html-button-response',
          stimulus: () => {
            all_correct = jsPsych.data.get().last(1).values()[0].correct;
            if(all_correct) {
              return `<p>Congrats, you got everything right</p>`
            } else {
              return `<p>At least one answer was incorrect. Please review instructions before continuing.</p>`
            }
          },
          choices: ['Continue']
        }

        var instruction_repeat = {
          timeline: [
            instructions,
            post_instructions_quiz,
            {
              type: `html-keyboard-response`,
              stimulus: () => {
                all_correct = jsPsych.data.get().last(1).values()[0].correct;
                if(all_correct) {
                  return `<p>Congrats, you got everything right!<br>Press any key to continue to the experiment.</p>`
                }  else {
                  return `<p>At least one answer is incorrect. Your participation is no longer requested in this experiment.</p>`
                }
              }
            }
          ],
          conditional_function: () => {
            all_correct = jsPsych.data.get().last(2).values()[0].correct;
            return !all_correct;
          }
        }

        var instructions_sequence = {
          timeline: [instructions, post_instructions_quiz, instuctions_quiz_feedback, instruction_repeat]
        }
        timeline.push(instructions_sequence)

        jsPsych.init({
            timeline: timeline,
            on_finish: () => {
              jsPsych.data.displayData();
            }
        });

    </script>
</html>
